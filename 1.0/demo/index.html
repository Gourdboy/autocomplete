<!doctype html>
<html>
<head>
    <meta charset="gbk"/>
    <title>AutoComplete组件</title>
    <script src="http://a.tbcdn.cn/s/kissy/1.3.0/kissy-min.js" charset="utf-8"></script>
    <style type="text/css">
        body {
            padding: 20px;
            text-align: left;
            font-size: 12px;
            line-height: 1.5;
            background: #e3e3e3;
        }

        * {
            margin: 0;
            padding: 0;
        }

        p {
            padding: 8px;
        }

        input {
            padding: 5px;
            width: 200px;
        }

        button {
            padding: 5px;
        }

        details {
            padding: 20px;
            background: #fff;
            margin: 20px 0;
        }

        summary {
            font-size: 14px;
            border-bottom: 2px solid #339bb9;
            padding: 5px;
            margin-bottom: 10px;
        }

        .code {
            width: 95%;
            background: #e3e3e3;
            border-radius: 5px;
            padding: 5px;
            line-height: 20px;
            height: auto;
            display: block;
            overflow: visible;
            height: 500px;
        }
    </style>
    <script type="text/javascript">
        var S = KISSY;
        S.Config.debug = true;
        if (S.Config.debug) {
            var srcPath = "../../../";
            S.config({
                packages: [
                    {
                        name                  : "gallery",
                        path                  : srcPath,
                        charset               : "utf-8",
                        ignorePackageNameInUri: true
                    }
                ]
            });
        }

    </script>
</head>
<body>
<h1>AutoComplete组件</h1>
<h4>author : Shuke </h4>

<details open>
    <summary>热门城市推荐 数据源：JSONP</summary>
    <form>
        <p><label for="J_Test">出发城市：</label><input type="text" id="J_Test"/>
            <button type="button" id="showmessage">显示提示信息</button>
            <span id="J_SelectedText"></span></p>
        <p>航程类型：
            <select name="" id="ss">
                <option value="ss">单程</option>
                <option value="ss">往返</option>
            </select>
        </p>
        <p>到达城市：<input type="text" id="J_Test2"/> (热门推荐城市数据来源本地)</p>

        <p>
            <button type="submit">搜索</button>
        </p>

    </form>
</details>
<script>
    S.use('gallery/autocomplete/1.0/index', function (S, Autocomplete) {
        var autocomplete = new Autocomplete({
            inputNode        : '#J_Test',
//                source : 'http://kezhan.trip.taobao.com/citysuggest.do?t=0&q={query}',
            source           : 'http://s.jipiao.trip.taobao.com/city_search.do?lines={maxResults}&q={query}',
            resultListLocator: 'result',//指定返回数据里的数组位置
            resultTextLocator: 'cityName',//指定文本内容
            activeFirstItem  : false,
//            hotSource : 'http://www.taobao.com/go/rgn/trip/chinahotcity_jsonp.php',//不指定及没有热门推荐
            resultFormatter  : function (query, results) {//对展示进行格式化
                return S.map(results, function (_item) {
                    return S.substitute('<div class="ks-ac-item-inner"><span class="ks-ac-name">{cityname}</span><span class="ks-ac-intro">{py}</span></div>', {
                        cityname: _item.text.replace(new RegExp(query, 'gi'), '<span class="ks-ac-message-hightlight">' + query + '</span>'),
                        py      : _item.raw.py.replace(new RegExp(query, 'gi'), '<span class="ks-ac-message-hightlight">' + query + '</span>')
                    });
                });
            }
        });
        S.one('#showmessage').on('click', function () {
            autocomplete.set('messageVisible', false);
            autocomplete.showMessage('通过showMessage接口调用');
        });
        autocomplete.on('select', function (e) {
            S.one('#J_SelectedText').html(S.one('#J_SelectedText').html() + '|' + e.result.text + '--------' + e.result.raw.cityCode);
        });
        var hot_source = {results: [
            { 'tabname': '热门城市', 'tabdata': [
                {'dt': ' ', 'dd': [
                    {'cityName': '西安', 'cityCode': 'SIA'} ,
                    {'cityName': '武汉', 'cityCode': 'WUH'} ,
                    {'cityName': '长沙', 'cityCode': 'CSX'} ,
                    {'cityName': '南京', 'cityCode': 'NKG'} ,
                    {'cityName': '大连', 'cityCode': 'DLC'}
                ]}
            ]},
            {'tabname': 'ABCDEFGH', 'tabdata': [
                {'dt': 'A', 'dd': [
                    {'cityName': '安庆', 'cityCode': 'AQG'} ,
                    {'cityName': '阿勒泰', 'cityCode': 'AAT'} ,
                    {'cityName': '安康', 'cityCode': 'AKA'} ,
                    {'cityName': '阿克苏', 'cityCode': 'AKU'}
                ]},
                {'dt': 'B', 'dd': [
                    {'cityName': '包头', 'cityCode': 'BAV'} ,
                    {'cityName': '北海', 'cityCode': 'BHY'} ,
                    {'cityName': '北京', 'cityCode': 'BJS'} ,
                    {'cityName': '百色', 'cityCode': 'AEB'} ,
                    {'cityName': '保山', 'cityCode': 'BSD'}
                ]},
                {'dt': 'C', 'dd': [
                    {'cityName': '长治', 'cityCode': 'CIH'} ,
                    {'cityName': '长春', 'cityCode': 'CGQ'} ,
                    {'cityName': '重庆', 'cityCode': 'CKG'} ,
                    {'cityName': '长沙', 'cityCode': 'CSX'} ,
                    {'cityName': '赤峰', 'cityCode': 'CIF'}
                ]},
                {'dt': 'D', 'dd': [
                    {'cityName': '大同', 'cityCode': 'DAT'} ,
                    {'cityName': '大连', 'cityCode': 'DLC'} ,
                    {'cityName': '敦煌', 'cityCode': 'DNH'}
                ]},
                {'dt': 'E', 'dd': [
                    {'cityName': '鄂尔多斯', 'cityCode': 'DSN'} ,
                    {'cityName': '恩施', 'cityCode': 'ENH'}
                ]},
                {'dt': 'F', 'dd': [
                    {'cityName': '福州', 'cityCode': 'FOC'} ,
                    {'cityName': '阜阳', 'cityCode': 'FUG'}
                ]},
                {'dt': 'G', 'dd': [
                    {'cityName': '贵阳', 'cityCode': 'KWE'} ,
                    {'cityName': '桂林', 'cityCode': 'KWL'} ,
                    {'cityName': '格尔木', 'cityCode': 'GOQ'}
                ]},
                {'dt': 'H', 'dd': [
                    {'cityName': '呼和浩特', 'cityCode': 'HET'} ,
                    {'cityName': '哈密', 'cityCode': 'HMI'} ,
                    {'cityName': '黑河', 'cityCode': 'HEK'}
                ]}
            ]}
        ]};
        var ac2 = new Autocomplete({
            inputNode        : '#J_Test2',
            source           : 'http://s.jipiao.trip.taobao.com//city_search.do?lines={maxResults}&q={query}',
            jsonpCallback    : 'callback',
            resultListLocator: 'result',//指定返回数据里的数组位置
            resultTextLocator: 'cityName',//指定文本内容
            hotSource        : hot_source,
            resultHighlighter: function (query, results) {
                return S.map(results, function (_item) {
                    return _item.text.replace(new RegExp(query, 'gi'), '<strong>' + query + '</strong>');
                });
            },
            resultFormatter  : function (query, results) {
                return S.map(results, function (_item) {
                    return S.substitute('<div class="ks-ac-item-inner"><span class="ks-ac-name">{cityname}</span><span class="ks-ac-intro">{py}</span></div>', {
                        cityname: _item.text,
                        py      : _item.raw.py
                    });
                });
            }
        });
    })
</script>
</body>
</html>
